<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Dashboard - Fountain School</title>
<style>
body{font-family:Arial,sans-serif;background:#f4f4f4;margin:0;padding:0;}
nav{background:#2c3e50;color:#fff;padding:10px;display:flex;gap:15px;}
nav a{color:#fff;text-decoration:none;}
nav a:hover{text-decoration:underline;}
.container{max-width:1000px;margin:50px auto;background:#fff;padding:20px;box-shadow:0 0 10px rgba(0,0,0,0.2);}
table{width:100%;border-collapse:collapse;margin-top:20px;}
th,td{border:1px solid #ccc;padding:8px;text-align:left;}
th{background:#2c3e50;color:#fff;}
button{padding:5px 10px;margin:2px;cursor:pointer;}
</style>
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
import { getFirestore, collection, getDocs, doc, updateDoc } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey:"YOUR_API_KEY",
  authDomain:"transport-35437.firebaseapp.com",
  projectId:"transport-35437",
  storageBucket:"transport-35437.appspot.com",
  messagingSenderId:"495834194048",
  appId:"1:495834194048:web:a9322dee4cd1d137280665"
};
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const logoutBtn=document.getElementById('logoutBtn');
const teachersTable=document.getElementById('teachersTable');
const busesTable=document.getElementById('busesTable');

const routes=["Ngarariga","Murengeti","Ndeiya","Limuru","Kwambira","Nyambare"];
const buses=["KCT664J","KCT882J","KCT662J","KBP910B","KCS098V"];

onAuthStateChanged(auth, user=>{
  if(!user)window.location.href="index.html";
  else user.getIdTokenResult().then(token=>{ if(!token.claims.admin)window.location.href="home.html"; });
});

logoutBtn.addEventListener('click',()=>signOut(auth).then(()=>window.location.href="index.html"));

async function loadTeachers(){
  const snapshot = await getDocs(collection(db,"teachers"));
  teachersTable.innerHTML="<tr><th>Name</th><th>Email</th><th>Phone</th><th>Class</th><th>Bus</th><th>Route</th><th>Assign</th></tr>";
  snapshot.forEach(docSnap=>{
    const t=docSnap.data();
    const tr=document.createElement('tr');
    tr.innerHTML=`
      <td>${t.name}</td>
      <td>${t.email}</td>
      <td>${t.phone}</td>
      <td>${t.class}</td>
      <td>${t.bus||""}</td>
      <td>${t.route||""}</td>
      <td>
        <select id="busSelect${docSnap.id}">${buses.map(b=>`<option value="${b}">${b}</option>`).join("")}</select>
        <select id="routeSelect${docSnap.id}">${routes.map(r=>`<option value="${r}">${r}</option>`).join("")}</select>
        <button onclick="assignRoute('${docSnap.id}')">Assign</button>
      </td>
    `;
    teachersTable.appendChild(tr);
  });
}

window.assignRoute=async function(uid){
  const bus=document.getElementById(`busSelect${uid}`).value;
  const route=document.getElementById(`routeSelect${uid}`).value;
  await updateDoc(doc(db,"teachers",uid),{bus:bus,route:route,accepted:false,shiftDone:false});
  alert("Assigned successfully!");
  loadTeachers();
};

loadTeachers();
</script>
</head>
<body>
<nav>
<a href="#">Admin Dashboard</a>
<a href="#" id="logoutBtn">Logout</a>
</nav>

<div class="container">
<h2>Teachers Management</h2>
<table id="teachersTable"></table>
</div>
</body>
</html>

